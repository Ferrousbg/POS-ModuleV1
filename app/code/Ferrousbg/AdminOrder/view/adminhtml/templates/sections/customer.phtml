<?php /** @var \Magento\Backend\Block\Template $block */ ?>

<div class="bg-white relative h-full flex flex-col"
     x-data="{
        newCustomerModalOpen: false,
        isEditMode: false,
        custType: 'b2c',

        // –°–ø–∏—Å—ä–∫ —Å –≥—Ä—É–ø–∏ (–¢–æ–≤–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –¥–æ–π–¥–µ –æ—Ç Magento, —Ç—É–∫ –µ –ø—Ä–∏–º–µ—Ä)
        customerGroups: [
            { id: 2, label: 'Wholesale (–ï–¥—Ä–æ)' },
            { id: 3, label: 'Retailer (–¢—ä—Ä–≥–æ–≤–µ—Ü)' },
            { id: 4, label: 'Tax Free (–ë–µ–∑ –î–î–°)' },
            { id: 5, label: 'VIP Partners' }
        ],

        openNewModal() {
            this.isEditMode = false;
            // Default group 1 for B2C
            this.customer = { group_id: 1, firstname: '', lastname: '', email: '', telephone: '' };
            this.invoiceData = { wants_invoice: false };
            this.custType = 'b2c';
            this.newCustomerModalOpen = true;
        },

        openEditModal() {
            if(!this.customer) return;
            this.isEditMode = true;
            // Auto-detect type based on group (Group 1 is usually General/B2C)
            this.custType = (this.customer.group_id && this.customer.group_id != 1) ? 'b2b' : 'b2c';
            this.newCustomerModalOpen = true;
        },

        toggleModal() {
            this.newCustomerModalOpen = !this.newCustomerModalOpen;
        }
     }">

    <!-- 1. HEADER & SEARCH -->
    <div class="p-6 border-b border-slate-100 bg-white sticky top-0 z-10">
        <div class="relative">
            <input type="text"
                   x-model="customerSearchQuery"
                   @input.debounce.300ms="searchCustomers()"
                   placeholder="–¢—ä—Ä—Å–µ–Ω–µ (–ò–º–µ / –¢–µ–ª / Email)"
                   class="w-full px-6 h-20 bg-slate-50 border-2 border-slate-200 rounded-2xl text-2xl font-black text-slate-800 focus:bg-white focus:border-orange-500 focus:ring-4 focus:ring-orange-50 transition-all outline-none placeholder-slate-400 shadow-sm">

            <button x-show="customerSearchQuery"
                    @click="customerSearchQuery = ''; customerResults = []"
                    class="absolute right-6 top-5 text-slate-300 hover:text-red-500 font-black text-3xl transition-colors">
                ‚úï
            </button>

            <!-- DROPDOWN RESULTS -->
            <div x-show="customerResults.length > 0" class="absolute top-full left-0 w-full mt-3 bg-white rounded-2xl shadow-2xl border border-slate-200 z-[50] max-h-[500px] overflow-y-auto">
                <template x-for="cust in customerResults" :key="cust.id">
                    <div @click="selectCustomer(cust)" class="px-8 py-6 hover:bg-orange-50 cursor-pointer border-b border-slate-100 last:border-0 group transition-colors">
                        <div class="font-black text-slate-800 text-2xl group-hover:text-orange-700 mb-1" x-text="cust.firstname + ' ' + cust.lastname"></div>
                        <div class="flex justify-between items-center">
                            <span class="text-xl text-slate-600 font-bold bg-slate-100 px-3 py-1 rounded-lg" x-text="cust.telephone"></span>
                            <span class="text-lg text-slate-400 font-medium" x-text="cust.email"></span>
                        </div>
                        <div x-show="cust.company" class="text-sm font-black uppercase text-slate-400 mt-2 tracking-wider" x-text="cust.company"></div>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <!-- 2. CONTENT AREA -->
    <div class="p-6 flex-1 overflow-y-auto">

        <!-- ACTIVE CUSTOMER CARD -->
        <!-- ACTIVE CUSTOMER CARD -->
        <div x-show="customer && customer.id" class="space-y-6 animate-fade-in-down" style="display: none;">

            <!-- IDENTITY CARD -->
            <div class="relative rounded-3xl border-2 shadow-sm overflow-hidden transition-all bg-white"
                 :class="customer.group_id != 1 ? 'border-purple-200' : 'border-slate-200'">

                <!-- Color Strip -->
                <div class="absolute top-0 left-0 w-5 h-full"
                     :class="customer.group_id != 1 ? 'bg-purple-600' : 'bg-orange-500'"></div>

                <div class="p-8 pl-12">

                    <!-- HEADER ROW: Group Badge + Actions -->
                    <div class="flex justify-between items-start mb-6">

                        <!-- –ì–†–£–ü–ê –ù–ê –ö–õ–ò–ï–ù–¢–ê (–ù–û–í–ê –õ–û–ì–ò–ö–ê) -->
                        <div class="flex flex-col items-start gap-1">
                            <!-- –û—Å–Ω–æ–≤–µ–Ω –ë–∞–¥–∂ -->
                            <span class="inline-flex items-center gap-2 px-5 py-2 rounded-xl text-base font-black uppercase tracking-wider shadow-sm border"
                                  :class="customer.group_id != 1 ? 'bg-purple-100 text-purple-800 border-purple-200' : 'bg-orange-100 text-orange-700 border-orange-200'">
                        <span class="text-xl" x-text="customer.group_id != 1 ? 'üè¢' : 'üë§'"></span>
                                <!-- –ü–æ–∫–∞–∑–≤–∞ –∏–º–µ—Ç–æ –Ω–∞ –≥—Ä—É–ø–∞—Ç–∞ –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç —Ç–µ–∫—Å—Ç -->
                        <span x-text="customer.group_name ? customer.group_name : (customer.group_id != 1 ? 'B2B PARTNER' : 'General B2C')"></span>
                    </span>

                            <!-- –ï—Ç–∏–∫–µ—Ç –∑–∞ —Ü–µ–Ω–æ–≤–∞ –ª–∏—Å—Ç–∞ (—Å–∞–º–æ –∞–∫–æ –µ B2B) -->
                            <span x-show="customer.group_id != 1" class="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-1 flex items-center gap-1">
                        üè∑Ô∏è Group <span class="text-purple-600" x-text="customer.group_name || 'Standard'"></span>
                    </span>
                        </div>

                        <!-- ACTION BUTTONS -->
                        <div class="flex gap-3">

                            <!-- –ù–û–í –ë–£–¢–û–ù: –ò–°–¢–û–†–ò–Ø -->
                            <button @click="fetchCustomerHistory()"
                                    class="flex flex-col items-center justify-center bg-indigo-50 hover:bg-indigo-100 border-2 border-indigo-100 hover:border-indigo-300 w-20 h-20 rounded-2xl transition-all shadow-sm active:scale-95 group">
                                <span class="text-3xl mb-1 text-indigo-400 group-hover:text-indigo-600">üìÇ</span>
                                <span class="text-[10px] font-black text-indigo-400 group-hover:text-indigo-600 uppercase">–ò—Å—Ç–æ—Ä–∏—è</span>
                            </button>

                            <!-- –¢–≤–æ—è—Ç –±—É—Ç–æ–Ω –∑–∞ —Ä–µ–¥–∞–∫—Ü–∏—è (–æ—Å—Ç–∞–≤–∏ —Å–∏ –≥–æ) -->
                            <button @click="openEditModal()"
                                    class="flex flex-col items-center justify-center bg-blue-50 hover:bg-blue-100 border-2 border-blue-100 hover:border-blue-300 w-20 h-20 rounded-2xl transition-all shadow-sm active:scale-95 group">
                                <span class="text-3xl mb-1 text-blue-400 group-hover:text-blue-600">‚úé</span>
                                <span class="text-[10px] font-black text-blue-400 group-hover:text-blue-600 uppercase"></span>
                            </button>

                            <!-- –¢–≤–æ—è—Ç –±—É—Ç–æ–Ω –∑–∞ —Ä–µ—Å–µ—Ç (–æ—Å—Ç–∞–≤–∏ —Å–∏ –≥–æ) -->
                            <button @click="resetCustomer()"
                                    class="flex flex-col items-center justify-center bg-white hover:bg-red-50 border-2 border-slate-200 hover:border-red-200 w-20 h-20 rounded-2xl transition-all shadow-sm active:scale-95 group">
                                <span class="text-3xl text-slate-400 group-hover:text-red-500 transition-colors">‚úï</span>
                                <span class="text-[10px] font-black text-slate-400 group-hover:text-red-500 uppercase"></span>
                            </button>
                        </div>
                    </div>

                    <!-- NAME & INFO -->
                    <div>
                        <h4 class="font-black text-5xl text-slate-800 leading-tight mb-6 flex flex-wrap items-baseline gap-4">
                            <span x-text="customer.firstname + ' ' + customer.lastname"></span>
                            <span class="text-xl font-bold text-slate-400 bg-slate-100 px-3 py-1 rounded-lg border border-slate-200 align-middle"
                                  x-text="'ID: ' + customer.id"></span>
                            </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="flex items-center gap-5">
                                <div class="w-14 h-14 rounded-2xl flex items-center justify-center text-3xl bg-slate-100 text-slate-500">üìû</div>
                                <div>
                                    <div class="text-xs font-black text-slate-400 uppercase tracking-wide">–¢–µ–ª–µ—Ñ–æ–Ω</div>
                                    <div class="text-3xl font-black text-slate-800 tracking-tight" x-text="customer.telephone"></div>
                                </div>
                            </div>
                            <div class="flex items-center gap-5" x-show="customer.email">
                                <div class="w-14 h-14 rounded-2xl flex items-center justify-center text-3xl bg-slate-100 text-slate-500">@</div>
                                <div class="overflow-hidden">
                                    <div class="text-xs font-black text-slate-400 uppercase tracking-wide">Email</div>
                                    <div class="text-2xl font-bold text-slate-700 truncate" x-text="customer.email"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            
            <!-- INVOICE DATA SECTION (COMPACT VIEW + MODAL) -->
            <div class="bg-white rounded-3xl border-2 border-slate-100 shadow-sm overflow-hidden mt-6">

                <!-- 1. HEADER / TOGGLE -->
                <div class="flex items-center gap-6 p-8 bg-slate-50 border-b border-slate-100 group transition-colors hover:bg-white">
                    <div class="relative flex items-center justify-center shrink-0">
                        <!-- –ß–µ–∫–±–æ–∫—Å—ä—Ç —Å–∞–º–æ –≤–∫–ª—é—á–≤–∞/–∏–∑–∫–ª—é—á–≤–∞ —Ä–µ–∂–∏–º–∞ -->
                        <input type="checkbox" x-model="invoiceData.wants_invoice"
                               @change="if(invoiceData.wants_invoice && !invoiceData.vat_id) invoiceModalOpen = true"
                               class="w-10 h-10 rounded-xl border-2 border-slate-300 text-orange-600 focus:ring-orange-500 cursor-pointer shadow-sm group-hover:border-orange-400 transition-colors">
                    </div>
                    <div class="flex-1 cursor-pointer" @click="invoiceData.wants_invoice = !invoiceData.wants_invoice">
                        <span class="block font-black text-slate-800 text-3xl uppercase leading-none">–î–∞–Ω–Ω–∏ –∑–∞ —Ñ–∞–∫—Ç—É—Ä–∞</span>
                        <span class="block text-base text-slate-400 font-bold mt-2" x-text="invoiceData.wants_invoice ? '–í–∫–ª—é—á–µ–Ω–æ –∏–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ —Ñ–∞–∫—Ç—É—Ä–∞' : '–ú–∞—Ä–∫–∏—Ä–∞–π—Ç–µ –∑–∞ —Ñ–∞–∫—Ç—É—Ä–∞'"></span>
                    </div>

                    <!-- EDIT BUTTON (–ü–æ–∫–∞–∑–≤–∞ —Å–µ —Å–∞–º–æ –∞–∫–æ –µ –≤–∫–ª—é—á–µ–Ω–æ) -->
                    <button x-show="invoiceData.wants_invoice"
                            @click="invoiceModalOpen = true"
                            class="flex items-center gap-2 bg-orange-100 hover:bg-orange-200 text-orange-700 px-5 py-3 rounded-xl transition-colors font-black uppercase text-sm tracking-wide">
                        <span>‚úèÔ∏è</span> –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π
                    </button>
                </div>

                <!-- 2. SUMMARY CARD (–ü–æ–∫–∞–∑–≤–∞ —Å–µ –∫–æ–≥–∞—Ç–æ –µ –≤–∫–ª—é—á–µ–Ω–æ) -->
                <div x-show="invoiceData.wants_invoice" x-transition class="p-8 bg-white">

                    <!-- –ê–∫–æ –∏–º–∞ –≤—ä–≤–µ–¥–µ–Ω–∏ –¥–∞–Ω–Ω–∏ -->
                    <div x-show="invoiceData.vat_id" class="flex flex-col gap-4">
                        <div class="flex items-start justify-between">
                            <div>
                                <div class="text-xs font-black text-slate-400 uppercase tracking-wider mb-1">–ü–æ–ª—É—á–∞—Ç–µ–ª (–§–∏—Ä–º–∞)</div>
                                <div class="text-2xl font-black text-slate-800" x-text="invoiceData.company || '---'"></div>
                            </div>
                            <div class="text-right">
                                <div class="text-xs font-black text-slate-400 uppercase tracking-wider mb-1">–ï–ò–ö / –ë—É–ª—Å—Ç–∞—Ç</div>
                                <div class="text-2xl font-mono font-bold text-slate-600 bg-slate-100 px-3 py-1 rounded-lg border border-slate-200" x-text="invoiceData.vat_id"></div>
                            </div>
                        </div>

                        <div class="h-px bg-slate-100 w-full my-2"></div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <div class="text-xs font-black text-slate-400 uppercase tracking-wider mb-1">–ú–û–õ</div>
                                <div class="text-lg font-bold text-slate-700" x-text="invoiceData.mol || '---'"></div>
                            </div>
                            <div>
                                <div class="text-xs font-black text-slate-400 uppercase tracking-wider mb-1">–ê–¥—Ä–µ—Å –∑–∞ —Ñ–∞–∫—Ç—É—Ä–∞</div>
                                <div class="text-lg font-bold text-slate-700">
                                    <span x-text="invoiceData.city"></span><span x-show="invoiceData.city && invoiceData.street">, </span>
                                    <span x-text="invoiceData.street"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –ê–∫–æ –µ –≤–∫–ª—é—á–µ–Ω–æ, –Ω–æ –Ω—è–º–∞ –¥–∞–Ω–Ω–∏ (–ø—Ä–∞–∑–Ω–æ) -->
                    <div x-show="!invoiceData.vat_id" class="text-center py-6 border-2 border-dashed border-orange-200 rounded-2xl bg-orange-50/50">
                        <p class="text-orange-800 font-bold mb-3">–õ–∏–ø—Å–≤–∞—Ç –¥–∞–Ω–Ω–∏ –∑–∞ —Ñ–∞–∫—Ç—É—Ä–∞—Ç–∞</p>
                        <button @click="invoiceModalOpen = true" class="bg-orange-500 hover:bg-orange-600 text-white font-black py-3 px-6 rounded-xl shadow-lg shadow-orange-200 transition-transform active:scale-95 uppercase">
                            + –í—ä–≤–µ–¥–∏ –î–∞–Ω–Ω–∏
                        </button>
                    </div>

                </div>
            </div>

            <!-- 3. INVOICE MODAL (–°–∫—Ä–∏—Ç –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ) -->
            <!-- –°–ª–∞–≥–∞–º–µ –≥–æ –≤ teleport –∏–ª–∏ –Ω–∞–π-–æ—Ç–¥–æ–ª—É –Ω–∞ body-—Ç–æ, –∑–∞ –¥–∞ –µ –Ω–∞–¥ –≤—Å–∏—á–∫–æ -->
            <div x-show="invoiceModalOpen" style="display: none;"
                 class="fixed inset-0 z-[9999] flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4"
                 x-transition.opacity>

                <div class="bg-white w-full max-w-2xl rounded-3xl shadow-2xl overflow-hidden flex flex-col border border-slate-200" @click.away="invoiceModalOpen = false">

                    <!-- Modal Header -->
                    <div class="bg-slate-50 px-8 py-6 border-b border-slate-100 flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <span class="text-3xl bg-white p-2 rounded-xl shadow-sm">üìÑ</span>
                            <h3 class="text-2xl font-black text-slate-800 uppercase">–†–µ–¥–∞–∫—Ü–∏—è –Ω–∞ –§–∞–∫—Ç—É—Ä–∞</h3>
                        </div>
                        <button @click="invoiceModalOpen = false" class="text-slate-400 hover:text-slate-600 font-bold text-3xl">&times;</button>
                    </div>

                    <!-- Modal Body (Inputs) -->
                    <div class="p-8 space-y-6 bg-white overflow-y-auto max-h-[70vh]">

                        <!-- Company -->
                        <div>
                            <label class="block text-sm font-black text-slate-400 uppercase mb-2 ml-1">–ò–º–µ –Ω–∞ —Ñ–∏—Ä–º–∞ <span class="text-red-500">*</span></label>
                            <input type="text" x-model="invoiceData.company" class="w-full px-5 h-14 bg-slate-50 border-2 border-slate-200 rounded-xl font-bold text-xl text-slate-800 focus:bg-white focus:border-orange-500 outline-none transition-colors" placeholder="–§–∏—Ä–º–∞ –û–û–î">
                        </div>

                        <!-- VAT & VAT No -->
                        <div class="grid grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-black text-slate-400 uppercase mb-2 ml-1">–ï–ò–ö / –ë—É–ª—Å—Ç–∞—Ç <span class="text-red-500">*</span></label>
                                <input type="text" x-model="invoiceData.vat_id" class="w-full px-5 h-14 bg-slate-50 border-2 border-slate-200 rounded-xl font-black text-xl text-slate-800 focus:bg-white focus:border-orange-500 outline-none transition-colors" placeholder="XXXXXXXXX">
                            </div>
                            <div>
                                <label class="block text-sm font-black text-slate-400 uppercase mb-2 ml-1">–î–î–° –ù–æ–º–µ—Ä</label>
                                <input type="text" x-model="invoiceData.vat_number" class="w-full px-5 h-14 bg-slate-50 border-2 border-slate-200 rounded-xl font-black text-xl text-slate-800 focus:bg-white focus:border-orange-500 outline-none transition-colors uppercase" placeholder="BG...">
                            </div>
                        </div>

                        <!-- Address -->
                        <div>
                            <label class="block text-sm font-black text-slate-400 uppercase mb-2 ml-1">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏ –ê–¥—Ä–µ—Å</label>
                            <div class="grid grid-cols-3 gap-4">
                                <div class="col-span-1">
                                    <input type="text" x-model="invoiceData.city" placeholder="–ì—Ä–∞–¥" class="w-full px-4 h-14 bg-slate-50 border-2 border-slate-200 rounded-xl font-bold text-lg focus:bg-white focus:border-orange-500 outline-none">
                                </div>
                                <div class="col-span-2">
                                    <input type="text" x-model="invoiceData.street" placeholder="–£–ª–∏—Ü–∞, –ù–æ–º–µ—Ä, –ë–ª–æ–∫" class="w-full px-4 h-14 bg-slate-50 border-2 border-slate-200 rounded-xl font-bold text-lg focus:bg-white focus:border-orange-500 outline-none">
                                </div>
                            </div>
                        </div>

                        <!-- MOL -->
                        <div>
                            <label class="block text-sm font-black text-slate-400 uppercase mb-2 ml-1">–ú–û–õ (–£–ø—Ä–∞–≤–∏—Ç–µ–ª)</label>
                            <input type="text" x-model="invoiceData.mol" class="w-full px-5 h-14 bg-slate-50 border-2 border-slate-200 rounded-xl font-bold text-xl text-slate-800 focus:bg-white focus:border-orange-500 outline-none transition-colors" placeholder="–ò–º–µ –∏ –§–∞–º–∏–ª–∏—è">
                        </div>
                    </div>

                    <!-- Modal Footer -->
                    <div class="p-6 bg-slate-50 border-t border-slate-100 flex justify-end">
                        <button @click="invoiceModalOpen = false" class="bg-orange-600 hover:bg-orange-700 text-white font-black py-4 px-10 rounded-2xl shadow-xl shadow-orange-200 text-lg uppercase tracking-wider transition-transform active:scale-95">
                            –ó–∞–ø–∞–∑–∏ –î–∞–Ω–Ω–∏—Ç–µ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ACTIONS (NO CUSTOMER) -->
        <div x-show="(!customer || !customer.id)" class="mt-6 space-y-6">
            <button @click="openNewModal()"
                    class="w-full py-8 bg-orange-600 hover:bg-orange-700 text-white font-black rounded-3xl shadow-xl shadow-orange-200/50 text-2xl transition-transform active:scale-[0.98] uppercase tracking-widest flex items-center justify-center gap-3">
                <span class="text-4xl leading-none">+</span> –ù–æ–≤ –ö–ª–∏–µ–Ω—Ç
            </button>
            <button @click="setGuestCustomer()"
                    class="w-full py-6 bg-white border-2 border-slate-200 text-slate-600 font-bold rounded-3xl hover:bg-slate-50 hover:border-slate-300 text-xl transition uppercase tracking-wide shadow-sm">
                –ì–æ—Å—Ç / –°–ª—É–∂–µ–±–µ–Ω
            </button>
        </div>
    </div>

    <!-- MODAL -->
    <div x-show="newCustomerModalOpen"
         style="display: none;"
         class="fixed inset-0 z-[9999] flex items-center justify-center bg-slate-900/80 backdrop-blur-md p-6"
         x-transition.opacity>

        <div class="bg-white w-full max-w-6xl rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[95vh] border border-slate-200">

            <!-- Modal Header -->
            <div class="bg-white px-10 py-8 border-b border-slate-100 flex justify-between items-center shrink-0">
                <h2 class="text-3xl font-black text-slate-800 uppercase tracking-tight">
                    <span x-text="isEditMode ? '–†–µ–¥–∞–∫—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç' : '–°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç'"></span>
                </h2>
                <button @click="toggleModal()" class="text-slate-400 hover:text-white hover:bg-red-500 font-black text-lg uppercase px-6 py-3 rounded-xl transition-all border-2 border-slate-100 hover:border-red-500">
                    –ó–∞—Ç–≤–æ—Ä–∏ X
                </button>
            </div>

            <!-- TABS -->
            <div class="flex border-b-2 border-slate-100 bg-slate-50 shrink-0">
                <button @click="custType = 'b2c'; customer.group_id = 1;"
                        class="flex-1 py-6 text-lg font-black uppercase tracking-wide transition-all border-b-4"
                        :class="custType === 'b2c' ? 'border-orange-500 text-orange-600 bg-white' : 'border-transparent text-slate-400 hover:text-slate-600 hover:bg-slate-100'">
                    –§–∏–∑–∏—á–µ—Å–∫–æ –õ–∏—Ü–µ (B2C)
                </button>
                <button @click="custType = 'b2b'; if(customer.group_id == 1) customer.group_id = 2;"
                        class="flex-1 py-6 text-lg font-black uppercase tracking-wide transition-all border-b-4"
                        :class="custType === 'b2b' ? 'border-purple-500 text-purple-700 bg-white' : 'border-transparent text-slate-400 hover:text-slate-600 hover:bg-slate-100'">
                    –§–∏—Ä–º–∞ (B2B)
                </button>
            </div>

            <!-- Modal Content -->
            <div class="p-10 overflow-y-auto custom-scroll flex-1 bg-white">

                <!-- === FORM: B2C === -->
                <div x-show="custType === 'b2c'" class="space-y-8" x-data="{ createAccount: false }">
                    <div class="p-5 bg-blue-50 text-blue-900 rounded-2xl text-lg font-bold mb-6 border border-blue-100 flex items-center gap-3">
                        <span class="text-3xl">üë§</span>
                        <div>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –ø–æ—Ä—ä—á–∫–∞ –∑–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ –ª–∏—Ü–µ.</div>
                    </div>
                    <div class="grid grid-cols-2 gap-8">
                        <div>
                            <label class="block text-sm font-black text-slate-500 uppercase mb-3 ml-1">–ò–º–µ <span class="text-red-500">*</span></label>
                            <input type="text" x-model="customer.firstname" class="w-full px-6 h-20 bg-slate-50 border-2 border-slate-200 rounded-2xl font-bold text-2xl text-slate-800 focus:bg-white focus:border-orange-500 focus:ring-4 focus:ring-orange-100 outline-none transition-all">
                        </div>
                        <div>
                            <label class="block text-sm font-black text-slate-500 uppercase mb-3 ml-1">–§–∞–º–∏–ª–∏—è <span class="text-red-500">*</span></label>
                            <input type="text" x-model="customer.lastname" class="w-full px-6 h-20 bg-slate-50 border-2 border-slate-200 rounded-2xl font-bold text-2xl text-slate-800 focus:bg-white focus:border-orange-500 focus:ring-4 focus:ring-orange-100 outline-none transition-all">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-8">
                        <div>
                            <label class="block text-sm font-black text-slate-500 uppercase mb-3 ml-1">–¢–µ–ª–µ—Ñ–æ–Ω <span class="text-red-500">*</span></label>
                            <input type="tel" x-model="customer.telephone" placeholder="08XX..." class="w-full px-6 h-20 bg-white border-2 border-slate-300 rounded-2xl font-black text-3xl text-slate-900 focus:border-orange-500 focus:ring-4 focus:ring-orange-100 outline-none shadow-sm transition-all">
                        </div>
                        <div>
                            <label class="block text-sm font-black text-slate-500 uppercase mb-3 ml-1">
                                Email
                                <span x-show="createAccount" class="text-red-500 ml-1" x-transition>(–ó–∞–¥—ä–ª–∂–∏—Ç–µ–ª–µ–Ω –∑–∞ –ø—Ä–æ—Ñ–∏–ª) *</span>
                                <span x-show="!createAccount" class="text-slate-400 font-medium normal-case ml-1">(–û–ø—Ü–∏—è –∑–∞ –∫–∞—Å–æ–≤–∞ –±–µ–ª–µ–∂–∫–∞)</span>
                            </label>
                            <input type="email" x-model="customer.email" class="w-full px-6 h-20 border-2 rounded-2xl font-bold text-xl text-slate-800 focus:ring-4 outline-none transition-all" :class="createAccount ? 'bg-white border-blue-300 focus:border-blue-500 ring-blue-50' : 'bg-slate-50 border-slate-200 focus:border-orange-500'">
                        </div>
                    </div>
                    <div class="bg-slate-50 p-6 rounded-3xl border border-slate-200 mt-6">
                        <label class="flex items-start gap-4 cursor-pointer select-none">
                            <div class="relative flex items-center pt-1 shrink-0">
                                <input type="checkbox" x-model="createAccount" class="w-8 h-8 text-blue-600 rounded-lg border-slate-300 focus:ring-blue-500 cursor-pointer">
                            </div>
                            <div class="flex flex-col">
                                <span class="font-black text-slate-800 text-xl uppercase leading-tight">–°—ä–∑–¥–∞–π –æ–Ω–ª–∞–π–Ω –ø—Ä–æ—Ñ–∏–ª</span>
                                <span class="text-sm text-slate-500 font-bold mt-1 leading-snug">–ö–ª–∏–µ–Ω—Ç—ä—Ç —â–µ –º–æ–∂–µ –¥–∞ –≤–ª–∏–∑–∞ –≤ —Å–∞–π—Ç–∞.</span>
                            </div>
                        </label>
                        <div x-show="createAccount" x-transition class="mt-4 pt-4 border-t border-slate-200 pl-12">
                            <div class="flex items-center gap-3 bg-blue-100 text-blue-800 p-4 rounded-xl border border-blue-200">
                                <span class="text-2xl">üîí</span>
                                <div><div class="font-bold uppercase text-xs text-blue-500 mb-0.5">–ü–∞—Ä–æ–ª–∞</div><div class="font-bold text-lg leading-tight">–ì–µ–Ω–µ—Ä–∏—Ä–∞ —Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.</div></div>
                            </div>
                        </div>
                    </div>
                    <div class="pt-6 border-t-2 border-slate-100 mt-4">
                        <label class="flex flex-row items-center justify-start gap-4 cursor-pointer select-none w-full p-4 rounded-2xl border-2 border-transparent hover:bg-slate-50 hover:border-slate-200 transition-all bg-white shadow-sm">
                            <div class="relative flex items-center justify-center shrink-0">
                                <input type="checkbox" x-model="invoiceData.wants_invoice" class="w-8 h-8 rounded border-gray-300 text-orange-600 focus:ring-orange-500 m-0 cursor-pointer shadow-sm">
                            </div>
                            <div class="flex flex-col text-left">
                                <span class="font-black text-slate-800 text-xl uppercase leading-none mb-1">–§–∞–∫—Ç—É—Ä–∞</span>
                                <span class="text-xs text-slate-400 font-bold uppercase tracking-wide">–í—ä–≤–µ–¥–µ—Ç–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏ –¥–∞–Ω–Ω–∏</span>
                            </div>
                        </label>
                        <div x-show="invoiceData.wants_invoice" x-transition class="mt-4 bg-slate-50 p-6 rounded-3xl border border-slate-200 space-y-6">
                            <div class="bg-blue-50 p-4 rounded-2xl border border-blue-100">
                                <label class="block text-xs font-black text-blue-800 uppercase mb-2 ml-1">–ï–ò–ö / –î–î–° –ù–æ–º–µ—Ä</label>
                                <div class="flex gap-3">
                                    <input type="text" x-model="invoiceData.vat_id" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –ï–ò–ö..." class="flex-1 px-5 h-16 border-2 border-blue-200 rounded-xl font-black text-2xl text-slate-900 bg-white focus:border-blue-500 outline-none uppercase shadow-sm">
                                    <button type="button" class="px-6 h-16 bg-blue-600 hover:bg-blue-700 text-white font-black rounded-xl uppercase tracking-wide shadow-lg flex flex-col items-center justify-center min-w-[120px]"><span class="text-2xl">‚ö°</span></button>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
                                <div class="md:col-span-2">
                                    <label class="block text-xs font-black text-slate-500 uppercase mb-2 ml-1">–ò–º–µ –Ω–∞ —Ñ–∏—Ä–º–∞ <span class="text-red-500">*</span></label>
                                    <input type="text" x-model="invoiceData.company" class="w-full px-5 h-14 border-2 border-slate-300 rounded-xl font-bold text-lg bg-white focus:border-orange-500 outline-none uppercase">
                                </div>
                                <div>
                                    <label class="block text-xs font-black text-slate-500 uppercase mb-2 ml-1">–ú–û–õ</label>
                                    <input type="text" x-model="invoiceData.mol" class="w-full px-5 h-14 border-2 border-slate-300 rounded-xl font-bold text-lg bg-white focus:border-orange-500 outline-none">
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-black text-slate-400 uppercase mb-2 ml-1">–ê–¥—Ä–µ—Å</label>
                                <div class="grid grid-cols-6 gap-3">
                                    <div class="col-span-2"><input type="text" x-model="invoiceData.city" placeholder="–ì—Ä–∞–¥" class="w-full px-4 h-14 border-2 border-slate-300 rounded-xl font-bold text-lg bg-white focus:border-orange-500 outline-none"></div>
                                    <div class="col-span-3"><input type="text" x-model="invoiceData.street" placeholder="–£–ª–∏—Ü–∞" class="w-full px-4 h-14 border-2 border-slate-300 rounded-xl font-bold text-lg bg-white focus:border-orange-500 outline-none"></div>
                                    <div class="col-span-1"><input type="text" x-model="invoiceData.street_number" placeholder="‚Ññ" class="w-full px-2 h-14 border-2 border-slate-300 rounded-xl font-bold text-lg bg-white focus:border-orange-500 outline-none text-center"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- === FORM: B2B === -->
                <div x-show="custType === 'b2b'" class="space-y-8">

                    <!-- HEADER -->
                    <div class="p-5 bg-purple-50 text-purple-900 rounded-2xl text-lg font-medium mb-6 flex items-start gap-4 border border-purple-100">
                        <span class="text-3xl">üè¢</span>
                        <div>
                            <span class="font-black block uppercase text-xl">–ë–∏–∑–Ω–µ—Å –ü–∞—Ä—Ç–Ω—å–æ—Ä (B2B)</span>
                            <p class="opacity-80 text-sm">–°—ä–∑–¥–∞–≤–∞–Ω–µ—Ç–æ –Ω–∞ –∞–∫–∞—É–Ω—Ç –µ –∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ.</p>
                        </div>
                    </div>

                    <!-- 1. –î–ê–ù–ù–ò –ó–ê –§–ò–†–ú–ê–¢–ê -->
                    <div class="bg-slate-50 p-8 rounded-3xl border border-slate-200">
                        <div class="flex justify-between items-center border-b-2 border-slate-200 pb-3 mb-6">
                            <h4 class="text-lg font-black text-slate-400 uppercase tracking-widest">–î–∞–Ω–Ω–∏ –∑–∞ —Ñ–∏—Ä–º–∞—Ç–∞</h4>
                            <button type="button" class="text-xs font-black text-white bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg uppercase tracking-wide shadow-md transition-transform active:scale-95 flex items-center gap-2">
                                <span>‚ö°</span> –ó–∞—Ä–µ–¥–∏ –ø–æ –ï–ò–ö
                            </button>
                        </div>

                        <div class="space-y-6">

                            <!-- CUSTOMER GROUP SELECTOR (NEW) -->
                            <div class="bg-white p-4 rounded-2xl border-2 border-purple-100">
                                <label class="block text-sm font-black text-purple-800 uppercase mb-2 ml-1">–ö–ª–∏–µ–Ω—Ç—Å–∫–∞ –ì—Ä—É–ø–∞ (–¶–µ–Ω–∏) <span class="text-red-500">*</span></label>
                                <div class="relative">
                                    <select x-model="customer.group_id" class="w-full px-6 h-16 bg-purple-50 border-2 border-purple-200 rounded-xl font-black text-xl text-purple-900 focus:border-purple-500 outline-none appearance-none cursor-pointer">
                                        <template x-for="group in customerGroups" :key="group.id">
                                            <option :value="group.id" x-text="group.label"></option>
                                        </template>
                                    </select>
                                    <div class="absolute right-6 top-1/2 -translate-y-1/2 pointer-events-none text-purple-600 text-xl">‚ñº</div>
                                </div>
                                <div class="text-xs font-bold text-purple-400 mt-2 ml-1">–ò–∑–±–µ—Ä–µ—Ç–µ –≥—Ä—É–ø–∞, –∑–∞ –¥–∞ –ø—Ä–∏–ª–æ–∂–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–Ω–∏—Ç–µ —Ü–µ–Ω–∏ –∏ –¥–∞–Ω—ä—Ü–∏.</div>
                            </div>

                            <div>
                                <label class="block text-sm font-black text-slate-500 uppercase mb-2 ml-1">–ï–ò–ö / –î–î–° –ù–æ–º–µ—Ä <span class="text-red-500">*</span></label>
                                <input type="text" x-model="invoiceData.vat_id" class="w-full px-6 h-16 bg-white border-2 border-slate-300 rounded-2xl font-black text-2xl text-slate-800 focus:border-purple-500 outline-none placeholder-slate-300" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –ï–ò–ö...">
                            </div>
                            <div>
                                <label class="block text-sm font-black text-slate-500 uppercase mb-2 ml-1">–ò–º–µ –Ω–∞ —Ñ–∏—Ä–º–∞ <span class="text-red-500">*</span></label>
                                <input type="text" x-model="invoiceData.company" class="w-full px-6 h-16 bg-white border-2 border-slate-300 rounded-2xl font-bold text-xl focus:border-purple-500 outline-none">
                            </div>
                            <div class="grid grid-cols-3 gap-6">
                                <div class="col-span-1">
                                    <label class="block text-sm font-black text-slate-500 uppercase mb-2 ml-1">–ì—Ä–∞–¥</label>
                                    <input type="text" x-model="invoiceData.city" class="w-full px-6 h-16 bg-white border-2 border-slate-300 rounded-2xl font-bold text-xl focus:border-purple-500 outline-none">
                                </div>
                                <div class="col-span-2">
                                    <label class="block text-sm font-black text-slate-500 uppercase mb-2 ml-1">–ê–¥—Ä–µ—Å</label>
                                    <input type="text" x-model="invoiceData.street" class="w-full px-6 h-16 bg-white border-2 border-slate-300 rounded-2xl font-bold text-xl focus:border-purple-500 outline-none">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-black text-slate-500 uppercase mb-2 ml-1">–ú–û–õ (–£–ø—Ä–∞–≤–∏—Ç–µ–ª)</label>
                                <input type="text" x-model="invoiceData.mol" class="w-full px-6 h-16 bg-white border-2 border-slate-300 rounded-2xl font-bold text-xl focus:border-purple-500 outline-none">
                            </div>
                            <div class="hidden"><input type="checkbox" x-model="invoiceData.wants_invoice" checked></div>
                        </div>
                    </div>

                    <!-- 2. CONTACT & ACCESS -->
                    <div class="pt-4">
                        <h4 class="text-lg font-black text-slate-400 uppercase tracking-widest mb-6 pb-2 border-b-2 border-slate-100">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ –õ–∏—Ü–µ & –î–æ—Å—Ç—ä–ø</h4>
                        <div class="grid grid-cols-2 gap-8 mb-6">
                            <div>
                                <label class="block text-sm font-black text-slate-500 uppercase mb-2 ml-1">–ò–º–µ <span class="text-red-500">*</span></label>
                                <input type="text" x-model="customer.firstname" class="w-full px-6 h-16 bg-white border-2 border-slate-300 rounded-2xl font-bold text-xl focus:border-purple-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-black text-slate-500 uppercase mb-2 ml-1">–§–∞–º–∏–ª–∏—è <span class="text-red-500">*</span></label>
                                <input type="text" x-model="customer.lastname" class="w-full px-6 h-16 bg-white border-2 border-slate-300 rounded-2xl font-bold text-xl focus:border-purple-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-black text-slate-500 uppercase mb-2 ml-1">–¢–µ–ª–µ—Ñ–æ–Ω <span class="text-red-500">*</span></label>
                                <input type="text" x-model="customer.telephone" class="w-full px-6 h-16 bg-white border-2 border-slate-300 rounded-2xl font-bold text-xl focus:border-purple-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-black text-slate-500 uppercase mb-2 ml-1">Email (–ó–∞ –≤—Ö–æ–¥) <span class="text-red-500">*</span></label>
                                <input type="email" x-model="customer.email" class="w-full px-6 h-16 bg-white border-2 border-purple-200 rounded-2xl font-bold text-xl text-slate-900 focus:border-purple-500 outline-none">
                            </div>
                        </div>

                        <!-- PASSWORD -->
                        <div class="bg-purple-50 p-6 rounded-3xl border border-purple-100 mt-6 relative overflow-hidden" x-data="{ showPass: false }">
                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-4">
                                    <span class="block text-sm font-black text-purple-800 uppercase ml-1">–°–∏–≥—É—Ä–Ω–æ—Å—Ç –∏ –ü–∞—Ä–æ–ª–∞</span>
                                    <button type="button" @click="showPass = !showPass" class="text-xs font-bold text-purple-600 uppercase flex items-center gap-2 hover:bg-purple-100 px-3 py-1 rounded transition">
                                        <span x-text="showPass ? 'üôà –°–∫—Ä–∏–π' : 'üëÅÔ∏è –ü–æ–∫–∞–∂–∏'"></span>
                                    </button>
                                </div>
                                <div class="grid grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-xs font-black text-purple-400 uppercase mb-2 ml-1">–ü–∞—Ä–æ–ª–∞ <span class="text-red-500">*</span></label>
                                        <input :type="showPass ? 'text' : 'password'" x-model="customer.password" class="w-full px-5 h-16 bg-white border-2 border-purple-200 rounded-xl font-bold text-xl focus:border-purple-500 outline-none transition-all placeholder-purple-200 tracking-wider" placeholder="******">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-black text-purple-400 uppercase mb-2 ml-1">–ü–æ–≤—Ç–æ—Ä–∏ –ü–∞—Ä–æ–ª–∞ <span class="text-red-500">*</span></label>
                                        <input :type="showPass ? 'text' : 'password'" x-model="customer.password_confirmation" class="w-full px-5 h-16 bg-white border-2 border-purple-200 rounded-xl font-bold text-xl focus:border-purple-500 outline-none transition-all placeholder-purple-200 tracking-wider" placeholder="******">
                                    </div>
                                </div>
                                <div class="mt-6 pt-4 border-t border-purple-200/50">
                                    <label class="flex items-center gap-4 cursor-pointer select-none group">
                                        <div class="relative flex items-center justify-center shrink-0 bg-white rounded-lg p-1 border-2 border-purple-200 group-hover:border-purple-400 transition-colors">
                                            <input type="checkbox" x-model="customer.force_pass_change" class="w-6 h-6 text-purple-600 rounded focus:ring-purple-500 border-none cursor-pointer">
                                        </div>
                                        <div>
                                            <span class="block font-black text-purple-900 text-lg uppercase leading-none">–ò–∑–∏—Å–∫–∞–π —Å–º—è–Ω–∞ –Ω–∞ –ø–∞—Ä–æ–ª–∞</span>
                                            <span class="text-xs text-purple-500 font-bold mt-1 block">–ü—Ä–∏ –ø—ä—Ä–≤–∏—è –≤—Ö–æ–¥ –∫–ª–∏–µ–Ω—Ç—ä—Ç —â–µ –±—ä–¥–µ –∑–∞–¥—ä–ª–∂–µ–Ω –¥–∞ —Å–∏ —Å–º–µ–Ω–∏ –ø–∞—Ä–æ–ª–∞—Ç–∞.</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Modal Footer -->
            <div class="p-8 border-t border-slate-100 bg-slate-50 shrink-0">
                <button @click="saveCustomerOnly(); toggleModal()"
                        class="w-full py-6 rounded-2xl text-2xl font-black text-white shadow-2xl transition-transform active:scale-[0.98] uppercase tracking-widest flex items-center justify-center gap-3"
                        :class="custType === 'b2c' ? 'bg-orange-600 hover:bg-orange-700 shadow-orange-300/50' : 'bg-purple-600 hover:bg-purple-700 shadow-purple-300/50'">
                    <span class="text-4xl leading-none" x-text="isEditMode ? 'üíæ' : (custType === 'b2c' ? '+' : 'üè¢')"></span>
                    <span x-text="isEditMode ? '–ó–ê–ü–ê–ó–ò –ü–†–û–ú–ï–ù–ò–¢–ï' : (custType === 'b2c' ? '–°–™–ó–î–ê–ô –ö–õ–ò–ï–ù–¢' : '–°–™–ó–î–ê–ô B2B –ü–†–û–§–ò–õ')"></span>
                </button>
            </div>
        </div>
    </div>

</div>