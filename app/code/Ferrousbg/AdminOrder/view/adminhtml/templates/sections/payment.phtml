<?php /** @var \Magento\Backend\Block\Template $block */ ?>

<!-- PAYMENT PANEL WRAPPER -->
<div class="bg-white rounded-2xl border border-slate-200 shadow-sm w-full relative mb-6 transition-all duration-200"
     x-init="initPaymentModule()">

    <!-- 1. HEADER ROW -->
    <div class="px-5 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50 rounded-t-2xl">
        <div class="flex items-center gap-3">
            <span class="text-2xl drop-shadow-sm">üí≥</span>
            <h3 class="text-lg font-black text-slate-800 tracking-tight uppercase">
                <?= $block->escapeHtml(__('–ü–ª–∞—â–∞–Ω–µ')) ?>
            </h3>
        </div>

        <button @click="isPaymentEdit = !isPaymentEdit"
                class="text-xs font-bold px-3 py-1.5 rounded-lg transition-colors border flex items-center gap-2 uppercase tracking-wide"
                :class="isPaymentEdit ? 'bg-orange-50 text-orange-600 border-orange-200 hover:bg-orange-100' : 'bg-white text-slate-500 border-slate-200 hover:text-slate-700'">
            <span x-text="isPaymentEdit ? '–ó–∞—Ç–≤–æ—Ä–∏' : '–ü—Ä–æ–º–µ–Ω–∏'"></span>
            <span class="text-lg leading-none" x-text="isPaymentEdit ? '√ó' : '‚úé'"></span>
        </button>
    </div>

    <!-- 2. CONTENT AREA -->
    <div class="p-5">
        <!-- A. SUMMARY VIEW -->
        <div x-show="!isPaymentEdit" class="animate-fade-in" @click="isPaymentEdit = true">
            <div class="flex items-center gap-4 p-4 rounded-2xl border border-slate-200 bg-white shadow-sm hover:border-orange-300 hover:shadow-md transition-all cursor-pointer group">
                <div class="bg-blue-50 w-14 h-14 rounded-xl text-blue-500 border border-blue-100 shrink-0 flex items-center justify-center text-3xl">
                    <span x-text="getSelectedMethodIcon()"></span>
                </div>
                <div class="flex-1 min-w-0">
                    <div class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">–ò–∑–±—Ä–∞–Ω –ú–µ—Ç–æ–¥</div>
                    <div class="text-xl font-black text-slate-800 leading-none" x-text="getSelectedMethodTitle()"></div>
                </div>
                <div class="self-center text-slate-300 group-hover:text-orange-400 transition-colors">‚úé</div>
            </div>
        </div>

        <!-- B. SELECTION LIST -->
        <div x-show="isPaymentEdit" class="space-y-3 animate-fade-in-down">
            <template x-for="pm in availablePaymentMethods" :key="pm.code">
                <label class="block relative cursor-pointer group">
                    <!-- –¢—É–∫ –µ –ø—Ä–æ–º—è–Ω–∞—Ç–∞: @change="onUserSelectPayment" -->
                    <input type="radio" name="payment_method" :value="pm.code"
                           x-model="selectedPaymentMethod"
                           @change="onUserSelectPayment(pm.code)"
                           class="peer sr-only">

                    <div class="flex items-center gap-4 p-4 rounded-xl border border-slate-200 bg-white peer-checked:border-orange-500 peer-checked:bg-orange-50/30 peer-checked:ring-2 peer-checked:ring-orange-100 transition-all hover:border-orange-300 hover:shadow-sm">
                        <div class="w-12 h-12 rounded-full flex items-center justify-center shrink-0 bg-slate-50 text-slate-400 peer-checked:bg-white peer-checked:text-orange-600 transition-colors text-2xl border border-slate-100">
                            <span x-text="pm.icon || 'üí≥'"></span>
                        </div>
                        <div class="flex-1">
                            <div class="font-black text-slate-800 text-base" x-text="pm.title"></div>
                            <div class="text-xs text-slate-500 font-bold uppercase mt-0.5" x-text="pm.code"></div>
                        </div>
                        <div class="w-6 h-6 rounded-full border-2 border-slate-300 peer-checked:border-orange-500 peer-checked:bg-orange-500 flex items-center justify-center text-white transition-all">
                            <svg class="w-4 h-4 opacity-0 peer-checked:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                    </div>
                </label>
            </template>
            <div x-show="availablePaymentMethods.length === 0" class="text-center py-6 text-slate-400 bg-slate-50 rounded-xl border border-dashed border-slate-200">
                –ù—è–º–∞ –∞–∫—Ç–∏–≤–Ω–∏ –º–µ—Ç–æ–¥–∏ –∑–∞ –ø–ª–∞—â–∞–Ω–µ.
            </div>
        </div>
    </div>

    <!-- 3. CONFIRMATION MODAL -->
    <!-- –ò–∑–ø–æ–ª–∑–≤–∞–º–µ fixed –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–∞–Ω–µ –∑–∞ –¥–∞ –µ –≤—ä—Ä—Ö—É –≤—Å–∏—á–∫–æ -->
    <div x-show="showSaveModal"
         style="display: none;"
         class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0">

        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden transform transition-all"
             @click.away="closeModal()">

            <!-- Modal Header -->
            <div class="bg-orange-50 px-6 py-4 border-b border-orange-100 flex items-center gap-3">
                <div class="bg-orange-100 p-2 rounded-full text-orange-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                </div>
                <h3 class="text-lg font-bold text-slate-800">–ó–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –º–µ—Ç–æ–¥?</h3>
            </div>

            <!-- Modal Body -->
            <div class="p-6 text-slate-600 text-base leading-relaxed">
                <p x-html="modalMessage"></p>
            </div>

            <!-- Modal Footer -->
            <div class="px-6 py-4 bg-slate-50 border-t border-slate-100 flex justify-end gap-3">
                <!-- –ù–µ -->
                <button @click="declineSaveDefault()"
                        class="px-4 py-2 rounded-xl text-slate-600 font-bold hover:bg-slate-200 transition-colors">
                    –ù–µ, —Å–∞–º–æ –∑–∞ —Ç–∞–∑–∏ –ø–æ—Ä—ä—á–∫–∞
                </button>

                <!-- –î–∞ -->
                <button @click="confirmSaveDefault()"
                        class="px-5 py-2 rounded-xl bg-slate-800 text-white font-bold hover:bg-slate-700 shadow-lg hover:shadow-xl transition-all flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    –î–∞, –∑–∞–ø–∞–∑–∏
                </button>
            </div>
        </div>
    </div>
</div>